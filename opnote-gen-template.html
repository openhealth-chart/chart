<!DOCTYPE html>
<html data-bs-theme="light" lang="en" style="background: url(&quot;https://cdn.bootstrapstudio.io/placeholders/1400x800.png&quot;);">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Opnote-Generator</title>
    <meta name="description" content="Opnote Generator">
    <link rel="stylesheet" href="{{assetsUriBase}}/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli&amp;display=swap">
    <style>
        textarea {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            box-sizing: border-box;
            resize: none;
            overflow: hidden;
        }
    </style>
</head>

<body style="background: linear-gradient(9deg, rgba(0,0,0,0.12) 0%, white 100%), url(&quot;{{assetsUriBase}}/assets/img/DALL-E-OR.webp&quot;);">
    <p style="text-align: center;color: var(--bs-emphasis-color);background: var(--bs-body-bg);">Disclaimer: This is a demonstration application. Do not use actual patient information!</p>
    <h2>Opnote: {{context.patient.name.[0].family}},{{context.patient.name.[0].given.[0]}}-{{context.patient.id}}</h2>
    <form>
          <label class="form-label" for="#op-date">Operative Date</label>
        <input class="form-control" id="op-date" style="color: var(--bs-emphasis-color);" name="op-date" type="date">
          <label class="form-label" for="#surgeon">Surgeon</label>
        <input class="form-control" type="text" id="surgeon" name="surgeon" value="Dr. {{decoded.firstname}} {{decoded.lastname}}">
          <label class="form-label" for="#assistant">Assistant</label>
        <input class="form-control" type="text" id="assistant" name="assistant">
          <label class="form-label" for="#preop-diagnoses">Pre Operative Diagnoses</label>
        <input class="form-control" type="text" id="preop-diagnoses" name="preop-diagnoses">
          <label class="form-label" for="#postop-diagnoses">Post Operative Diagnoses</label>
        <input class="form-control" type="text" id="postop-diagnoses" name="postop-diagnoses">
          <label class="form-label" for="#procedures">proceduresList</label>
        <textarea id="procedures" name="procedures" rows="1" placeholder="Procedure (one per line)..."></textarea>
          <label class="form-label" for="#anaethesia">proceduresList</label>
        <select id="anaesthesia" name="anaesthesia">
            <option value="general">General Anaesthesia</option>
            <option value="local">Local Anaesthesia</option>
            <option value="regional">Regional Anaesthesia</option>
            <option value="sedation">Sedation</option>
        </select>
          <label class="form-label" for="#indications">Indications</label>
        <textarea id="indications" name="indications" rows="4" placeholder="Indications ..."></textarea>
          <label class="form-label" for="#description">Description of Procedure</label>
        <textarea id="description" name="description" rows="6" placeholder="Description of procedure ..."></textarea>
        <input class="btn btn-primary" type="submit">
    </form>
    <script>
        //let authorizationHeader = null;
        //let taskHeader = null;

    document.addEventListener('DOMContentLoaded', (event) => {
        document.getElementById('submitForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission

            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries()); // Convert FormData to JSON object
            console.log("submitting to {{location}}:",formData);
            
            const procedures = document.getElementById('procedures');
            const proceduresList = procedures.value.split('\n').filter(line => line.trim() !== '');
            data.procedures = proceduresList;

            const result = fetch('{{location}}', {
                method: 'POST',
                headers: {
                    'Authorization':  'Bearer {{accessToken}}', //authorizationHeader, //
                    'X-Chart-Task' : '{{context.taskId}}', //taskHeader, 
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(JSON.stringify(data))
            })
            .then(response => {
                // Update the headers
                //authorizationHeader = response.headers.get('Authorization');
                //taskHeader = response.headers.get('X-Chart-Task');
                //console.log("auth:",authorizationHeader);
                 // Return the response as text/html
                 return response.text();
             })
            .then(html => {
             // Replace the entire document with the returned HTML
                document.open();
                document.write(html);
                document.close();
            })
            .catch(error => console.error('Error:', error));
         });
         const indications = document.getElementById('indications');
         const procedures = document.getElementById('procedures');

         indications.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
        });
         procedures.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
        });
        description.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
        });
});
           // Initialize the height of the textarea
           indications.style.height = indications.scrollHeight + 'px';
           procedures.style.height = procedures.scrollHeight + 'px';
           description.style.height = description.scrollHeight + 'px';
        </script>
   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/new-age.js"></script>
</body>

</html>